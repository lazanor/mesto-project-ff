(()=>{"use strict";var e=function(e,t,n,o,r,c,u,i,a,l){var s=document.querySelector("#card-template").content.querySelector(".card").cloneNode(!0);s.querySelector(".card__title").textContent=t,s.querySelector(".card__image").src=n,s.querySelector(".card__image").alt="Фотография места: ".concat(t),s.querySelector(".card__like-counter").textContent=o;var p=s.querySelector(".card__delete-button");i?p.addEventListener("click",(function(){return u(p.closest(".card"),e,a,l)})):p.classList.add("card__delete-button-disabled"),s.querySelector(".card__image").addEventListener("click",(function(){return r(n,t)}));var d=s.querySelector(".card__like-button");return d.addEventListener("click",(function(){return c(d,e,a,l)})),s},t=function(e,t,n,o){e.classList.contains("card__like-button_is-active")?fetch("".concat(n,"/likes/").concat(t),{method:"DELETE",headers:{authorization:o}}).then((function(e){return e.ok?e.json():Promise.reject("Ошибка запроса: ".concat(e.status))})).then((function(t){e.classList.remove("card__like-button_is-active"),e.parentNode.querySelector(".card__like-counter").textContent=t.likes.length})).catch((function(e){return console.log("Ошибка. Запрос не выполнен. "+e)})):fetch("".concat(n,"/likes/").concat(t),{method:"PUT",headers:{authorization:o}}).then((function(e){return e.ok?e.json():Promise.reject("Ошибка запроса: ".concat(e.status))})).then((function(t){e.classList.add("card__like-button_is-active"),e.parentNode.querySelector(".card__like-counter").textContent=t.likes.length})).catch((function(e){return console.log("Ошибка. Запрос не выполнен. "+e)}))},n=function(e,t,n,o){fetch("".concat(n,"/").concat(t),{method:"DELETE",headers:{authorization:o}}).then((function(e){return e.ok?e.json():Promise.reject("Ошибка запроса: ".concat(e.status))})).then((function(t){return e.remove()})).catch((function(e){return console.log("Ошибка. Запрос не выполнен. "+e)}))},o=function(e){e.classList.add("popup_is-opened"),e.addEventListener("click",u),document.addEventListener("keydown",c)},r=function(e){e.classList.remove("popup_is-opened"),e.removeEventListener("click",u),document.removeEventListener("keydown",c)},c=function(e){if("Escape"===e.key){var t=document.querySelector(".popup_is-opened");t&&r(t)}},u=function(e){var t=document.querySelector(".popup_is-opened");t&&(e.composedPath().includes(t.querySelector(".popup__content"))||r(t))},i=function(e,t){Array.from(e.querySelectorAll(t.inputSelector)).forEach((function(n){n.value="",n.classList.remove(t.inputErrorClass),e.querySelector("".concat(t.inputSelector,"_type_").concat(n.name,"-error")).textContent=""}))},a={formSelector:".popup__form",inputSelector:".popup__input",submitButtonSelector:".popup__button",inactiveButtonClass:"popup__button_disabled",inputErrorClass:"popup__input_type_error",errorClass:"popup__error_visible"},l="https://nomoreparties.co/v1/wff-cohort-39/users/me",s="https://nomoreparties.co/v1/wff-cohort-39/cards",p="bc5ec85e-2904-4d40-86fe-731d5cf8c1ff",d=document.querySelector(".content"),_=d.querySelector(".places__list"),f=document.querySelector(".popup_type_new-card"),m=document.querySelector(".popup_type_edit"),y=document.querySelector(".popup_type_edit-avatar"),v=document.querySelector(".popup_type_image"),h=function(e,t){o(v);var n=v.querySelector(".popup__image");n.src=e,n.alt="Фотография места: ".concat(t),v.querySelector(".popup__caption").textContent=t};!function(){var c=d.querySelector(".profile__add-button"),u=d.querySelector(".profile__edit-button"),S=d.querySelector(".profile__image-edit"),q=document.querySelector(".popup_type_new-card .popup__content .popup__close"),k=document.querySelector(".popup_type_edit .popup__content .popup__close"),C=document.querySelector(".popup_type_edit-avatar .popup__content .popup__close"),E=document.querySelector(".popup_type_image .popup__content .popup__close"),b=document.querySelector(".popup_type_new-card .popup__button"),L=document.querySelector(".popup_type_edit .popup__button"),g=document.querySelector(".popup_type_edit-avatar .popup__button");c.addEventListener("click",(function(){o(f),i(f,a)})),u.addEventListener("click",(function(){return j(m)})),S.addEventListener("click",(function(){o(y),i(y,a)})),q.addEventListener("click",(function(){return r(f)})),k.addEventListener("click",(function(){return r(m)})),C.addEventListener("click",(function(){return r(y)})),E.addEventListener("click",(function(){return r(v)}));var x=document.forms["new-place"];x.addEventListener("submit",(function(o){return function(o){o.preventDefault();var c=x.elements["place-name"].value,u=x.elements.link.value;fetch(s,{method:"POST",headers:{authorization:p,"Content-Type":"application/json"},body:JSON.stringify({name:c,link:u})}).then((function(e){return e.ok?(b.textContent="Сохранение...",e.json()):Promise.reject("Ошибка запроса: ".concat(e.status))})).then((function(o){var r=e(o._id,o.name,o.link,0,h,t,n,1,s,p);_.prepend(r),b.textContent="Сохранить"})).catch((function(e){return console.log("Ошибка. Запрос не выполнен. "+e)})),r(f),x.reset()}(o)}));var j=function(e){o(e),i(e,a);var t=document.forms["edit-profile"],n=t.elements.name,r=t.elements.description;n.value=document.querySelector(".profile__title").textContent,r.value=document.querySelector(".profile__description").textContent},P=document.forms["edit-profile"],w=P.elements.name,T=P.elements.description;P.addEventListener("submit",(function(e){return function(e,t,n,o){e.preventDefault(),fetch(l,{method:"PATCH",headers:{authorization:p,"Content-Type":"application/json"},body:JSON.stringify({name:n,about:o})}).then((function(e){return e.ok?(L.textContent="Сохранение...",e.json()):Promise.reject("Ошибка запроса: ".concat(e.status))})).then((function(e){d.querySelector(".profile__title").textContent=e.name,d.querySelector(".profile__description").textContent=e.about,L.textContent="Сохранить"})).catch((function(e){return console.log("Ошибка. Запрос не выполнен. "+e)})),r(t),P.reset()}(e,m,w.value,T.value)}));var z=document.forms["edit-avatar"];z.addEventListener("submit",(function(e){return function(e,t){e.preventDefault(),fetch("".concat(l,"/avatar"),{method:"PATCH",headers:{authorization:p,"Content-Type":"application/json"},body:JSON.stringify({avatar:z.elements.link.value})}).then((function(e){return e.ok?(g.textContent="Сохранение...",e.json()):Promise.reject("Ошибка запроса: ".concat(e.status))})).then((function(e){document.querySelector(".profile__image").style.backgroundImage="url(".concat(e.avatar,")"),g.textContent="Сохранить"})).catch((function(e){return console.log("Ошибка. Запрос не выполнен. "+e)})),r(t),P.reset()}(e,y)}))}();var S,q,k=null;(S=l,q=p,fetch(S,{headers:{authorization:q}}).then((function(e){return e.ok?e.json():Promise.reject("Ошибка запроса: ".concat(e.status))})).then((function(e){return k=e,document.querySelector(".profile__title").textContent=e.name,document.querySelector(".profile__description").textContent=e.about,document.querySelector(".profile__image").style.backgroundImage="url(".concat(e.avatar,")"),e})).catch((function(e){return console.log("Ошибка. Запрос не выполнен. "+e)}))).then((function(o){k=o,function(o){fetch(s,{headers:{authorization:p}}).then((function(e){return e.ok?e.json():Promise.reject("Ошибка запроса: ".concat(e.status))})).then((function(r){r.forEach((function(r){var c=e(r._id,r.name,r.link,r.likes.length,h,t,n,k._id===r.owner._id,s,p);o.append(c),r.likes.some((function(e){return e._id===k._id}))&&c.querySelector(".card__like-button").classList.add("card__like-button_is-active")}))})).catch((function(e){return console.log("Ошибка. Запрос не выполнен. "+e)}))}(_)})),function(e){Array.from(document.querySelectorAll(e.formSelector)).forEach((function(t){var n=t.querySelector(e.submitButtonSelector),o=Array.from(t.querySelectorAll(e.inputSelector));o.forEach((function(r){r.addEventListener("input",(function(){(function(e,t,n){t.validity.patternMismatch?t.setCustomValidity(t.dataset.errorMessage):t.setCustomValidity(""),t.validity.valid?function(e,t,n){var o=e.querySelector("".concat(n.inputSelector,"_type_").concat(t.name,"-error"));t.classList.remove(n.inputErrorClass),o.textContent=""}(e,t,n):function(e,t,n,o){var r=e.querySelector("".concat(o.inputSelector,"_type_").concat(t.name,"-error"));t.classList.add(o.inputErrorClass),r.textContent=n}(e,t,t.validationMessage,n)})(t,r,e),function(e,t,n){!function(e){return e.some((function(e){return!e.validity.valid}))}(e)?t.classList.remove(n):t.classList.add(n)}(o,n,e.inactiveButtonClass)}))}))}))}(a)})();